# 远程服务测试脚本使用说明

## 概述

`test_remote_services.py` 是一个专门用于测试部署在远程服务器上的华语服务引擎的测试脚本。该脚本可以测试所有文本服务和多模态服务的可用性，并生成详细的测试报告。

## 功能特性

- ✅ **网络连通性测试** - 检查是否能连接到远程服务器
- ✅ **健康检查测试** - 验证服务是否正常运行
- ✅ **文本服务测试** - 测试所有7种文本服务
- ✅ **多模态服务测试** - 测试PDF和图片处理服务
- ✅ **响应时间统计** - 记录每个接口的响应时间
- ✅ **详细错误报告** - 提供具体的错误信息
- ✅ **测试报告保存** - 自动保存JSON格式的测试报告
- ✅ **多种测试模式** - 支持本地、远程和自定义地址测试

## 使用方法

### 1. 基本使用

```bash
# 测试远程服务（默认）
python test_remote_services.py

# 测试本地服务
python test_remote_services.py --local

# 测试远程服务（显式指定）
python test_remote_services.py --remote

# 测试自定义地址
python test_remote_services.py http://your-server:8888
```

### 2. 测试内容

脚本会自动测试以下服务：

#### 文本服务
1. **招标公告产品服务** (`bidding_product`)
2. **中标公告产品服务** (`winning_product`)
3. **编号提取服务** (`code_extraction`)
4. **地区时间提取服务** (`district_time`)
5. **公告类型分类** (`notice_type`)
6. **采购类型分类** (`bid_type`)
7. **联系人信息解析** (`contact_info`)

#### 多模态服务
1. **PDF文本提取** (`multimodal_pdf`)
2. **图片OCR文本提取** (`multimodal_images`)

### 3. 输出示例

```
华语服务引擎远程测试脚本
============================================================
测试远程服务 (默认)
目标地址: http://115.231.130.211:8888

=== 测试网络连通性 ===
✅ 网络连通性 (0.15s)

=== 测试健康检查接口 (http://115.231.130.211:8888/health) ===
✅ 健康检查 (0.23s)
   服务状态: healthy
   服务名称: huayu_service_engine
   版本: 1.0.0

=== 测试文本服务: bidding_product ===
✅ 文本服务-bidding_product (0.45s)
   返回数据: {
       "notice_id": "BID001",
       "service_type": "bidding_product",
       "bidding_products": [...]
   }

============================================================
测试结果汇总
============================================================
测试开始时间: 2024-01-01 12:00:00
测试结束时间: 2024-01-01 12:01:30
测试总耗时: 90.25秒
测试目标: http://115.231.130.211:8888

详细结果:
  ✅ 网络连通性 (0.15s)
  ✅ 健康检查 (0.23s)
  ✅ 文本服务-bidding_product (0.45s)
  ✅ 文本服务-winning_product (0.38s)
  ...

文本服务测试: 7/7 成功
多模态服务测试: 2/2 成功
总体成功率: 9/9 (100.0%)

🎉 所有测试通过！远程服务运行正常。

📄 测试报告已保存: remote_test_report_20240101_120130.json
```

## 配置说明

### 修改目标地址

如果需要测试其他服务器，可以修改脚本开头的配置：

```python
# 远程服务配置
REMOTE_BASE_URL = "http://115.231.130.211:8888"  # 修改为你的服务器地址
LOCAL_BASE_URL = "http://localhost:8888"
TIMEOUT = 30  # 请求超时时间（秒）
```

### 自定义测试数据

可以在 `run_all_tests()` 方法中修改测试数据：

```python
text_services = [
    ("bidding_product", "BID001", "你的测试内容..."),
    # 添加更多测试用例
]
```

## 测试报告

### 报告格式

测试完成后会自动生成JSON格式的测试报告，包含：

```json
{
  "test_time": "2024-01-01T12:00:00",
  "target_url": "http://115.231.130.211:8888",
  "total_tests": 9,
  "success_count": 9,
  "results": [
    {
      "test_name": "健康检查",
      "success": true,
      "response_time": 0.23,
      "error": null,
      "timestamp": "2024-01-01T12:00:00.123456"
    }
  ]
}
```

### 报告文件命名

报告文件按时间戳命名：`remote_test_report_YYYYMMDD_HHMMSS.json`

## 错误处理

### 常见错误及解决方案

1. **连接失败**
   ```
   ❌ 网络连通性 (0.15s)
      错误: 端口 8888 不可达
   ```
   - 检查服务器是否启动
   - 检查防火墙设置
   - 确认端口是否正确

2. **请求超时**
   ```
   ❌ 文本服务-bidding_product
      错误: 请求超时
   ```
   - 增加 `TIMEOUT` 值
   - 检查网络连接
   - 检查服务器负载

3. **服务错误**
   ```
   ❌ 文本服务-bidding_product (0.45s)
      错误: Internal server error
   ```
   - 检查服务器日志
   - 确认服务配置正确

## 依赖要求

```bash
pip install requests
```

## 注意事项

1. **网络环境**：确保本地网络可以访问目标服务器
2. **防火墙**：确保目标服务器的8888端口开放
3. **服务状态**：确保远程服务已正常启动
4. **测试频率**：避免过于频繁的测试，以免影响服务器性能

## 故障排除

### 如果测试失败

1. **检查网络连接**
   ```bash
   ping 115.231.130.211
   telnet 115.231.130.211 8888
   ```

2. **检查服务状态**
   ```bash
   curl http://115.231.130.211:8888/health
   ```

3. **查看详细错误**
   - 检查生成的测试报告文件
   - 查看控制台输出的详细错误信息

4. **联系运维人员**
   - 提供测试报告文件
   - 说明具体的错误信息
   - 确认服务器配置是否正确 